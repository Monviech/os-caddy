# DO NOT EDIT THIS FILE -- OPNsense auto-generated file
{
    # Global options
    storage file_system {
        root /usr/local/etc/caddy
    }

    # Global logging
    log {
        output file /var/log/caddy/caddy.log {
            roll_size 100MiB
            roll_keep 5
            roll_keep_for 720h
        }
    }

    # Global TLS settings
{% if helpers.exists('Pischem.caddy.general.TlsEmail') %}
    email {{ helpers.toList('Pischem.caddy.general.TlsEmail') | first }}
{% endif %}
{% if helpers.exists('Pischem.caddy.general.TlsAutoHttps') %}
    {% set autoHttpsValue = helpers.toList('Pischem.caddy.general.TlsAutoHttps') | first %}
    {% if autoHttpsValue != "on" %}
    auto_https {{ autoHttpsValue }}
    {% endif %}
{% endif %}

    # Include all .global files from caddy.d directory
    import /usr/local/etc/caddy/caddy.d/*.global
}

{% if helpers.exists('Pischem.caddy.reverseproxy.reverse') %}
{% for item in helpers.toList('Pischem.caddy.reverseproxy.reverse') %}
{% set reverse = item %}
{% if reverse.Enabled|default("0") == "1" %}
# Reverse proxy entry "{{ reverse.Description|default("") }}":
{{ reverse.FromDomain|default("") }}{% if reverse.FromPort|default("") %}:{{ reverse.FromPort }}{% endif %} {
    reverse_proxy {{ reverse.ToDomain|default("") }}:{{ reverse.ToPort|default("") }}
    {% if reverse.DnsChallenge|default("0") == "1" %}
    tls {
        dns {{ helpers.toList('Pischem.caddy.general.TlsDnsProvider') | first }} {{ helpers.toList('Pischem.caddy.general.TlsDnsApiKey') | first }}
    }
    {% endif %}
}
{% endif %}
{% endfor %}
{% endif %}

# Include all .conf files from caddy.d directory
import /usr/local/etc/caddy/caddy.d/*.conf
